{% block content %}
  
<div class="overflow-x-auto bg-white rounded-lg shadow">
  <table class="table table-zebra w-full text-sm">
    <thead class="bg-base-200">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Barcode</th>
        <th>Sale Price</th>
        <th>Cost Price</th>
        <th>Stock Status</th>
        <th>Category</th>
        <th>Supplier</th>
        <th>Expires</th>
        <th>Image</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ product.name }}</td>
        <td>{{ product.barcode }}</td>
        <td>{{ product.sale_price }}</td>
        <td>{{ product.cost_price }}</td>
        <td>TBD</td>
        <td>{{ product.category.name | default:"—" }}</td>
        <td>{{ product.supplier.name | default:"—" }}</td>
        <td>{{ product.expiration_date|date:"Y-m-d" | default:"—" }}</td>
        <td>
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="Product" class="w-10 h-10 object-cover rounded" />
          {% else %}
            —
          {% endif %}
        </td>
        <td class="flex gap-2">
          <a 
            class="btn btn-xs btn-info" 
            title="View"
            hx-get="{% url 'products:product_detail' product.id %}" 
            hx-target="#productModalContent"
            hx-swap="innerHTML"
            onclick="productModal.showModal()"
          >
            <span class="w-6 h-6 flex items-center justify-center">
              {% include 'includes/svg/circle_info_icon.html' %}
            </span>
          </a>
          {% if request.user.role == 'admin' or request.user.role == 'inventory_manager' %}
          <a 
            class="btn btn-xs btn-warning" 
            title="Edit"
            hx-get="{% url 'products:product_update' product.id %}" 
            hx-target="#productModalContent"
            hx-swap="innerHTML"
            onclick="productModal.showModal()"
          >
            <span class="w-6 h-6 flex items-center justify-center">
              {% include 'includes/svg/pen_icon.html' %}
            </span>
          </a>
          <a 
            class="btn btn-xs btn-accent" 
            title="Update Price"
            hx-get="{% url 'products:product_price_update' product.id %}" 
            hx-target="#productModalContent"
            hx-swap="innerHTML"
            onclick="productModal.showModal()"
          >
            <span class="w-6 h-6 flex items-center justify-center">
              {% include 'includes/svg/bd_taka_icon.html' %}
            </span>
          </a>
          <a 
            class="btn btn-xs btn-error" 
            title="Delete"
            hx-get="{% url 'products:product_delete' product.id %}" 
            hx-target="#productModalContent"
            hx-swap="innerHTML"
            onclick="productModal.showModal()"
          >
            <span class="w-6 h-6 flex items-center justify-center">
              {% include 'includes/svg/delete_icon.html' %}
            </span>
          </a>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="11" class="text-center text-gray-500 py-4">No products found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="mt-4 flex justify-center">
  <div class="join">
    {% if page_obj.has_previous %}
      <a href="?page=1" class="join-item btn btn-sm">First</a>
      <a href="?page={{ page_obj.previous_page_number }}" class="join-item btn btn-sm">«</a>
    {% endif %}
    <span class="join-item btn btn-sm btn-disabled">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="join-item btn btn-sm">»</a>
      <a href="?page={{ page_obj.paginator.num_pages }}" class="join-item btn btn-sm">Last</a>
    {% endif %}
  </div>
</div>
{% endif %}

{% comment %} Product create/update/detail/price-update Modal {% endcomment %}

<dialog id="productModal" class="modal">
  <div class="modal-box">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
    </form>
    <div id="productModalContent">
      <span class="loading loading-spinner"></span>
    </div>
  </div>
</dialog>

{% endblock %}